<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Excel FILTER + VSTACK Formula Builder</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    input, textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { padding: 10px 20px; font-size: 14px; margin-top: 10px; margin-right: 10px; }
    .output-box { background: #f4f4f4; padding: 10px; white-space: pre-wrap; min-height: 40px; margin-bottom: 10px; }
    label { font-weight: bold; }
  </style>
</head>
<body>

  <h2>ğŸ§® Excel FILTER + VSTACK Formula Builder</h2>

  <label>ğŸ“Œ Data Array (e.g., <code>'Sheet1'!A2:Z100</code>):</label>
  <input type="text" id="dataArray" placeholder="'Sheet1'!A2:Z100">

  <label>ğŸ” Column to Filter On (e.g., <code>C</code>):</label>
  <input type="text" id="searchColumn" placeholder="C">

  <label>ğŸ” Values to Match (one per line):</label>
  <textarea id="searchValues" rows="5" placeholder="Approved&#10;Pending"></textarea>

  <label>ğŸ“‹ Header Row Number (defaults to 1):</label>
  <input type="number" id="headerRow" placeholder="1" min="1" value="1">

  <button onclick="generateFormulas()">Generate Formulas</button>

  <h3>âœ… VSTACK Formula:</h3>
  <div class="output-box" id="vstackOutput"></div>
  <button onclick="copyToClipboard('vstackOutput')">ğŸ“‹ Copy VSTACK</button>

  <h3>âœ… FILTER Formula:</h3>
  <div class="output-box" id="filterOutput"></div>
  <button onclick="copyToClipboard('filterOutput')">ğŸ“‹ Copy FILTER</button>

  <script>
    function generateFormulas() {
      const dataArray = document.getElementById("dataArray").value.trim();
      const searchColumn = document.getElementById("searchColumn").value.trim().toUpperCase();
      const values = document.getElementById("searchValues").value.trim().split('\n').filter(Boolean);
      const headerRow = parseInt(document.getElementById("headerRow").value.trim()) || 1;

      if (!dataArray || !searchColumn || values.length === 0) {
        alert("Please fill in all the fields.");
        return;
      }

      const sheetMatch = dataArray.match(/^'?([^']+)'?!([A-Z]+\d*:[A-Z]+\d*)$/);
      if (!sheetMatch) {
        alert("Invalid data array format. Use format like 'Sheet1'!A2:Z100");
        return;
      }

      const sheetName = `'${sheetMatch[1]}'`;
      const range = sheetMatch[2];
      const rowMatch = range.match(/\D+(\d+):\D+(\d+)/);
      const startRow = rowMatch ? rowMatch[1] : "2";
      const endRow = rowMatch ? rowMatch[2] : "";

      const filterRange = `${sheetName}!${searchColumn}${startRow}:${searchColumn}${endRow}`;
      const conditionParts = values.map(val => `(${filterRange}="${val.trim()}")`);
      const conditionString = conditionParts.join(" + ");

      const headerRef = `${sheetName}!${headerRow}:${headerRow}`;
      const vstackFormula = `=VSTACK(${headerRef}, FILTER(${sheetName}!${range}, ${conditionString}))`;
      const filterFormula = `=FILTER(${sheetName}!${range}, ${conditionString})`;

      document.getElementById("vstackOutput").textContent = vstackFormula;
      document.getElementById("filterOutput").textContent = filterFormula;
    }

    function copyToClipboard(elementId) {
      const text = document.getElementById(elementId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("âœ… Formula copied to clipboard!");
      }, () => {
        alert("âŒ Failed to copy.");
      });
    }
  </script>

</body>
</html>
