<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Extract & Merge Strings Between Delimiters</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea, input { width: 100%; margin-bottom: 10px; box-sizing: border-box; }
    label { font-weight: bold; display:block; margin-top: 8px; }
    .row { display: flex; align-items: center; gap: 8px; margin: 4px 0; }
    .chip { background:#f4f4f4; padding:6px 10px; border-radius:14px; }
    .copy-icon {
      cursor: pointer;
      width: 20px;
      height: 20px;
      fill: #666;
      transition: fill 0.2s ease;
    }
    .copy-icon:hover { fill: #000; }
    #outputContainer { margin-top: 8px; }
    .hint { color:#666; font-size: 12px; margin-top: 4px; }
  </style>
</head>
<body>

<h2>Extract Text Between Delimiters</h2>

<label>Start Delimiter:</label>
<input type="text" id="startDelimiter" value="<">

<label>End Delimiter:</label>
<input type="text" id="endDelimiter" value=">">

<label>Input Text:</label>
<textarea id="inputText" rows="5" placeholder="Example: Contact &lt;jane@example.com&gt; and &lt;sam@domain.io&gt;."></textarea>

<div class="row" style="margin-top:6px;">
  <input type="checkbox" id="enableMerge" onchange="toggleMerge()">
  <label for="enableMerge" style="margin:0; font-weight:normal;">Merge extracted strings</label>
</div>

<div id="mergeOptions" style="display: none;">
  <label>Merge Delimiter (e.g., comma, space):</label>
  <input type="text" id="mergeDelimiter" value=", ">
</div>

<button onclick="extractValues()">Extract</button>

<h3>Output:</h3>
<div id="outputContainer">
  <div id="message" class="hint">Nothing extracted yet.</div>
  <div id="outputList"></div>
  <div id="mergedBlock" style="display:none;">
    <div class="row" style="align-items: flex-start;">
      <div id="mergedText" class="chip" style="flex:1; overflow:auto; white-space:pre-wrap;"></div>
      <svg class="copy-icon" id="copyMergedBtn" onclick="copyText(document.getElementById('mergedText').innerText, this)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 
                 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 
                 16H8V7h11v14z"/>
      </svg>
    </div>
  </div>
</div>

<script>
  function escapeRegex(text) {
    return text.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
  }

  function toggleMerge() {
    document.getElementById("mergeOptions").style.display =
      document.getElementById("enableMerge").checked ? "block" : "none";
  }

  async function copyText(text, icon) {
    try {
      await navigator.clipboard.writeText(text);
      const originalColor = icon.style.fill;
      icon.style.fill = "green";
      setTimeout(() => (icon.style.fill = ""), 900);
    } catch (e) {
      alert("Copy failed. Select and copy manually.");
    }
  }

  function clearOutput() {
    document.getElementById('outputList').innerHTML = '';
    document.getElementById('mergedText').innerText = '';
    document.getElementById('mergedBlock').style.display = 'none';
    document.getElementById('message').style.display = 'none';
  }

  function extractValues() {
    const input = document.getElementById('inputText').value;
    const start = document.getElementById('startDelimiter').value;
    const end = document.getElementById('endDelimiter').value;
    const enableMerge = document.getElementById('enableMerge').checked;
    const mergeDelimiter = document.getElementById('mergeDelimiter').value;

    const listEl = document.getElementById('outputList');
    const mergedBlock = document.getElementById('mergedBlock');
    const mergedText = document.getElementById('mergedText');
    const message = document.getElementById('message');

    clearOutput();

    if (!start || !end) {
      message.style.display = 'block';
      message.textContent = "Please enter both start and end delimiters.";
      return;
    }

    const regex = new RegExp(escapeRegex(start) + "(.*?)" + escapeRegex(end), "g");
    let match;
    const results = [];

    while ((match = regex.exec(input)) !== null) {
      const val = (match[1] || '').trim();
      if (val) results.push(val);
    }

    if (results.length === 0) {
      message.style.display = 'block';
      message.textContent = "No values found.";
      return;
    }

    if (enableMerge) {
      mergedText.innerText = results.join(mergeDelimiter);
      mergedBlock.style.display = 'block';
    } else {
      results.forEach(val => {
        const row = document.createElement('div');
        row.className = 'row';

        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = val;

        const svgNS = "http://www.w3.org/2000/svg";
        const icon = document.createElementNS(svgNS, "svg");
        icon.setAttribute("class", "copy-icon");
        icon.setAttribute("viewBox", "0 0 24 24");
        icon.innerHTML = `<path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 
                           0-2 .9-2 2v14c0 1.1.9 2 2 
                           2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 
                           16H8V7h11v14z"/>`;
        icon.addEventListener('click', () => copyText(val, icon));

        row.appendChild(chip);
        row.appendChild(icon);
        listEl.appendChild(row);
      });
    }
  }
</script>

</body>
</html>
